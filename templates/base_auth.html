<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LovePython{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“š</text></svg>">
    {% block styles %}{% endblock %}
    <style>
        /* ç™»å½•é¡µé¢èƒŒæ™¯æ ·å¼ä¼˜åŒ– */
        .auth-page-wrapper {
            position: relative;
            overflow: hidden;
        }
        
        /* è§†é¢‘èƒŒæ™¯å®¹å™¨ */
        .auth-background-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            opacity: 0.85;
        }
        
        /* å›¾ç‰‡èƒŒæ™¯ï¼ˆå¤‡ç”¨ï¼‰ */
        .auth-background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            opacity: 0.8;
            display: block; /* é»˜è®¤æ˜¾ç¤ºï¼Œè§†é¢‘åŠ è½½æˆåŠŸåç”±JSéšè— */
        }
        
        /* SVGèƒŒæ™¯ï¼ˆæœ€åå¤‡ç”¨ï¼‰ */
        .auth-page-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("{{ url_for('static', filename='dog_background.svg') }}");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.2;
            z-index: 0;
            /* é»˜è®¤æ˜¾ç¤ºï¼Œå¦‚æœè§†é¢‘æˆ–å›¾ç‰‡å­˜åœ¨åˆ™é€šè¿‡JSéšè— */
        }
        
        /* èƒŒæ™¯é®ç½©å±‚ï¼Œå¢å¼ºå¯è¯»æ€§ */
        .auth-background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(240, 247, 255, 0.2) 0%, rgba(234, 245, 255, 0.2) 100%);
            z-index: 0;
        }
        
        /* ç¡®ä¿å†…å®¹åœ¨èƒŒæ™¯ä¹‹ä¸Š */
        .auth-page-wrapper > * {
            position: relative;
            z-index: 1;
        }
        
        /* ç”µè„‘ç«¯ä¼˜åŒ– - è§†é¢‘èƒŒæ™¯æ›´æ˜æ˜¾ */
        @media (min-width: 769px) {
            .auth-background-video {
                opacity: 0.9;
            }
            
            .auth-background-image {
                opacity: 0.85;
            }
            
            .auth-background-overlay {
                background: linear-gradient(135deg, rgba(240, 247, 255, 0.15) 0%, rgba(234, 245, 255, 0.15) 100%);
            }
        }
        
        /* ç§»åŠ¨ç«¯èƒŒæ™¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .auth-background-video {
                opacity: 0.6;
                /* ç§»åŠ¨ç«¯å¯ä»¥éšè—è§†é¢‘ä»¥èŠ‚çœæµé‡ */
                display: none;
            }
            
            .auth-background-image {
                opacity: 0.5;
                display: block;
            }
            
            .auth-page-wrapper::before {
                opacity: 0.5;
                background-size: contain;
                background-position: center bottom;
                display: block;
            }
        }
        
        @media (max-width: 480px) {
            .auth-background-image {
                opacity: 0.4;
            }
            
            .auth-page-wrapper::before {
                opacity: 0.4;
            }
        }
    </style>
</head>
<body>
    <div class="auth-page-wrapper" style="min-height: 100vh; display: flex; flex-direction: column; justify-content: center; background: linear-gradient(135deg, #f0f7ff 0%, #eaf5ff 100%), url(&quot;{{ url_for('static', filename='dog_background.svg') }}&quot;); background-size: cover; background-position: center;">
        <!-- è§†é¢‘èƒŒæ™¯ï¼ˆä¼˜å…ˆï¼Œç”µè„‘ç«¯æ˜¾ç¤ºï¼‰ -->
        <video class="auth-background-video" id="authBackgroundVideo" autoplay muted loop playsinline>
            <source src="{{ url_for('static', filename='background/login_bg.mp4') }}" type="video/mp4">
            <source src="{{ url_for('static', filename='background/login_bg.webm') }}" type="video/webm">
        </video>
        
        <!-- å›¾ç‰‡èƒŒæ™¯ï¼ˆå¤‡ç”¨ï¼Œå¦‚æœè§†é¢‘ä¸å­˜åœ¨ï¼‰ -->
        <img class="auth-background-image" id="authBackgroundImage" 
             src="{{ url_for('static', filename='background/login_bg.jpg') }}" 
             alt="èƒŒæ™¯å›¾ç‰‡"
             onerror="this.style.display='none'; document.getElementById('authBackgroundVideo').style.display='none';">
        
        <!-- èƒŒæ™¯é®ç½©å±‚ -->
        <div class="auth-background-overlay"></div>
        <!-- Flashæ¶ˆæ¯ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="container" style="max-width: 400px; margin: 0 auto;">
                    {% for category, message in messages %}
                        <div class="alert {% if category == 'error' %}alert-danger{% elif category == 'success' %}alert-success{% else %}alert-info{% endif %}">
                            {% if category == 'error' %}
                                <i class="fas fa-exclamation-circle"></i>
                            {% elif category == 'success' %}
                                <i class="fas fa-check-circle"></i>
                            {% else %}
                                <i class="fas fa-info-circle"></i>
                            {% endif %}
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <!-- ä¸»å†…å®¹ -->
        {% block content %}{% endblock %}
        
        <!-- é¡µè„š -->
        <footer style="text-align: center; margin-top: 2rem; color: var(--gray-600);">
            <p class="footer-text">
                &copy; {{ current_year|default(2023) }} LovePython | 
                <a href="https://github.com/yunyunfanfan" class="footer-link" target="_blank">
                    <i class="fab fa-github"></i> GitHub
                </a> | 
                <a href="mailto:zhjunjian2024@lzu.edu.cn" class="footer-link">
                    <i class="fas fa-envelope"></i> è”ç³»æˆ‘ä»¬
                </a>
            </p>
        </footer>
    </div>
    
    {% block scripts %}{% endblock %}
    <script>
        // æ£€æµ‹å¹¶åŠ è½½èƒŒæ™¯è§†é¢‘/å›¾ç‰‡
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('authBackgroundVideo');
            const image = document.getElementById('authBackgroundImage');
            const wrapper = document.querySelector('.auth-page-wrapper');
            let videoLoaded = false;
            let imageLoaded = false;
            
            // éšè—SVGèƒŒæ™¯çš„è¾…åŠ©å‡½æ•°
            function hideSVGBackground() {
                if (wrapper) {
                    wrapper.style.setProperty('--show-svg-bg', 'none');
                    const style = document.createElement('style');
                    style.textContent = '.auth-page-wrapper::before { display: none !important; }';
                    document.head.appendChild(style);
                }
            }
            
            // æ£€æµ‹è§†é¢‘æ˜¯å¦å¯ä»¥åŠ è½½
            if (video) {
                video.addEventListener('loadeddata', function() {
                    // è§†é¢‘åŠ è½½æˆåŠŸ
                    videoLoaded = true;
                    if (image) image.style.display = 'none';
                    hideSVGBackground();
                });
                
                video.addEventListener('canplay', function() {
                    // è§†é¢‘å¯ä»¥æ’­æ”¾
                    videoLoaded = true;
                    if (image) image.style.display = 'none';
                    hideSVGBackground();
                });
                
                video.addEventListener('error', function() {
                    // è§†é¢‘åŠ è½½å¤±è´¥ï¼Œå°è¯•æ˜¾ç¤ºå›¾ç‰‡
                    video.style.display = 'none';
                    if (image) {
                        image.style.display = 'block';
                        // æ£€æµ‹å›¾ç‰‡æ˜¯å¦å¯ä»¥åŠ è½½
                        if (image.complete && image.naturalHeight !== 0) {
                            // å›¾ç‰‡å·²åŠ è½½
                            imageLoaded = true;
                            hideSVGBackground();
                        } else {
                            image.onload = function() {
                                imageLoaded = true;
                                hideSVGBackground();
                            };
                            image.onerror = function() {
                                // å›¾ç‰‡ä¹ŸåŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºSVGèƒŒæ™¯ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰
                                image.style.display = 'none';
                            };
                        }
                    } else {
                        // æ²¡æœ‰å›¾ç‰‡å…ƒç´ ï¼Œæ˜¾ç¤ºSVGèƒŒæ™¯ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰
                    }
                });
                
                // å°è¯•åŠ è½½è§†é¢‘
                video.load();
            } else if (image) {
                // æ²¡æœ‰è§†é¢‘å…ƒç´ ï¼Œåªæ£€æµ‹å›¾ç‰‡
                if (image.complete && image.naturalHeight !== 0) {
                    imageLoaded = true;
                    image.style.display = 'block';
                    hideSVGBackground();
                } else {
                    image.onload = function() {
                        imageLoaded = true;
                        image.style.display = 'block';
                        hideSVGBackground();
                    };
                    image.onerror = function() {
                        // å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºSVGèƒŒæ™¯ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰
                        image.style.display = 'none';
                    };
                }
            }
        });
    </script>
</body>
</html>